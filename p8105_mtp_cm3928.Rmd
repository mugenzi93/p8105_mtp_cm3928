---
title: "p8105 Midterm Project"
author: "Clement Mugenzi"
date: "10/17/2019"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(viridis)
library(wordcountaddin)
library(readxl)
library(readr)
library(patchwork)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```


# Introduction

This project uses data analysis concepts to expand on a study that have been conducted examining the association between smart device use and enlarged "hornlike" spike mostly found in millenial's skulls.  


# Data Description

```{r}
hornlike_df = 
  read_excel("Data/p8105_mtp_data.xlsx", 
             range = "A9:I1230") %>% 
  janitor::clean_names() %>% 
# changing to appropriate variable names.
  rename(eop_group = "eop_size", eop_size = "eop_size_mm",
         fhp_size = "fhp_size_mm", fhp_group = "fhp_category",
         enlarged_eop = "eop_visibility_classification") %>%
# replacing missing values in the eop_size variable by 0.
# Creating character and ordered factors for categorical variables.
  mutate(
    eop_size = replace_na(eop_size, 0),
    sex = recode(sex, "0" = "Female", "1" = "Male"),
    age_group = recode(age_group,"2" = "18-30", 
                       "3" = "31-40", "4" = "41-50",
                       "5" = "51-60", "6" = "60+",
                       "7" = "60+", "8" = "60+"),
    eop_group = recode(eop_group, "0" = "0-5", "1" = "5-10", 
                       "2" = "10-15", "3" = "15-20",
                        "4" = "20-25", "5" = "25+"),
    fhp_group = recode(fhp_group, "0" = "0-10", "1" = "10-20",
                       "2" = "20-30", "3" = "30-40", 
                       "4" = "40-50", "5" = "50-60",
                       "6" = "60+", "7" = "60+"),
    enlarged_eop = recode(enlarged_eop, "0" = "Absent",
                            "1" = "Visible", "2" = "Fully Developed"),
    sex = factor(sex, levels = c("Female", "Male")),
    enlarged_eop = factor(enlarged_eop, levels = c("Absent",
                                                       "Visible",
                                                       "Fully Developed")),
    eop_shape = factor(eop_shape, levels = c("0", "1", "2", "3")),
    age_group = factor(age_group, levels = c("18-30", "31-40",
                                              "41-50", "51-60",
                                              "60+")),
    eop_group = factor(eop_group, levels = c("0-5", "5-10",
                                             "10-15", "15-20",
                                             "20-25", "25+")),
    fhp_group = factor(fhp_group, levels = c("0-10", "10-20",
                                             "20-30", "30-40",
                                             "40-50", "50-60",
                                             "60+"))) %>%
  arrange(sex) %>% 
  select(-eop_shape)
```


This dataset is comprised of **`r ncol(hornlike_df)`** variables and **`r nrow(hornlike_df)`** observations which is also the number representative of how many participants were studied by the original scientific report. In brief, I started by renaming relevant variables with appropriate names then used **mutate** function to recode values and redefine **sex, eop_visibility, age_group, eop_group, and fhp_group** variables by making them factors. 

```{r}
# Age and Gender Distribution
age_gender = 
  hornlike_df %>% 
  group_by(sex, age_group) %>% 
# renaming age group here but this won't affect the main dataframe.
  rename("Age Group" = "age_group") %>% 
  drop_na() %>%  
  summarise(
    frequency = n()) %>% 
  pivot_wider(
    names_from = sex,
    values_from = frequency) %>% 
  knitr::kable()
age_gender
```


## Issues with the Dataset

```{r}
# EOP Size and Group
hornlike_df %>% 
  drop_na() %>% 
  ggplot(aes(x = eop_group, y = eop_size, color = eop_size)) +
  geom_point() +
  labs(
    title = "Figure 1. EOP Size Versus EOP Group",
    x = "EOP Group",
    y = "EOP Size")
```

I notice several issues in this figure. Here the categorical variable **eop_group** is misclassifying several continuous **eop_size** values. For instance, in the range **20-25**, the eop size seems to span values ranging from 20 to about 35 mm. Also, there is a value with size **15.0 mm** that was not classified in either **10-15** or **15-20** ranges.


```{r}
# FHP Size and Group
hornlike_df %>% 
  drop_na() %>% 
  ggplot(aes(x = fhp_group, y = fhp_size, color = fhp_size)) +
  geom_point() +
  labs(
    title = "Figure 2. FHP Size Versus FHP Group",
    x = "FHP Group",
    y = "FHP Size")
```

The same pattern of misclassification is happening here as well where FHP sizes are being classified in groups they should not be classified in due to poor definitions of ranges on the part of the researcher. An example here would be a **FHP size** of **30.3 mm** being considered as a missing value instead of being classified in the **30-40** range.


# Visualization

```{r}
# Fig.3 and Fig.4
fig_3 = 
  hornlike_df %>% 
  drop_na() %>% 
  ggplot(aes(x = fhp_size, fill = age_group)) +
  geom_histogram(position = "dodge", binwidth = 3) +
  labs(
    title = "Distribution of FHP Size with respect to Sex",
    x = "FHP Size",
    y = "Count",
    caption = "Figure.3 Size between 0 and 89.3"
  )

fig_4 = 
  hornlike_df %>% 
  group_by(enlarged_eop, age_group, sex) %>% 
  filter(enlarged_eop == "Fully Developed") %>% 
  summarise(
    num_eeop = n()) %>% 
  mutate(
    percent_eeop = num_eeop/sum(num_eeop) * 100) %>% 
  filter(num_eeop != 1) %>% 
  ggplot(aes(x = age_group, y = percent_eeop, color = sex, group = sex)) +
  geom_point() + 
  geom_line() +
  labs(
    title = "Figure.4 Rate of EEOP per Age Group",
    x = "Age Group",
    y = "Rate (Percent)"
  )

fig_3 / fig_4
```

From figure 3, we can clearly conclude that most FHP sizes are concentrated in the 18-30 age group and within 10-30 mm range. And from figure 4, there is a higher and lower percentages of EEOP in males and females respectively, all in the 41-50 age group.

```{r}
# 2x5 Collection of Panels
male_panel = 
  hornlike_df %>% 
  drop_na() %>% 
  filter(sex == "Male") %>% 
  ggplot(aes(x = fhp_size, y = eop_size, color = age_group)) +
  facet_grid(~age_group) + 
  geom_point() + 
  theme(legend.position = "none") +
  geom_smooth(color = "black", linetype = 1) +
  labs(
    title = "Association between FHP and EOP sizes in Men",
    x = "FHP Size (mm)",
    y = "EOP Size (mm)"
  )


female_panel = 
  hornlike_df %>% 
  drop_na() %>% 
  filter(sex == "Female") %>% 
  ggplot(aes(x = fhp_size, y = eop_size, color = age_group)) +
  facet_grid(~age_group) +
  geom_point() +
  geom_smooth(color = "black", linetype = 1) +
  labs(
    title = "Association between FHP and EOP sizes in Women",
    x = "FHP Size (mm)",
    y = "EOP Size (mm)",
    color = "Age Group"
  )

male_panel / female_panel 
```

There seems to be an positive association between FHP and EOP sizes for female subjects in the 18-30 age group and male subjects in the above 60 age group. 


















































